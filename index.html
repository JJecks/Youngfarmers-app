<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Young Farmers Stock Management</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  
  <!-- Auth Screen -->
  <div id="auth-screen" class="screen">
    <!-- Login Container -->
    <div id="login-container" class="auth-container">
      <h1>Young Farmers</h1>
      <h2>Stock Management System</h2>
      
      <form id="login-form" class="auth-form">
        <h3>Login</h3>
        <input type="email" id="login-email" placeholder="Email" required>
        <input type="password" id="login-password" placeholder="Password" required>
        <button type="submit" class="btn-primary">Login</button>
        <button type="button" id="google-login-btn" class="btn-google">Login with Google</button>
        <p>Don't have an account? <a href="#" id="show-signup">Sign up</a></p>
      </form>
    </div>

    <!-- Signup Container -->
    <div id="signup-container" class="auth-container" style="display: none;">
      <h1>Young Farmers</h1>
      <h2>Stock Management System</h2>
      
      <form id="signup-form" class="auth-form">
        <h3>Sign Up</h3>
        <input type="text" id="signup-name" placeholder="Full Name" required>
        <input type="email" id="signup-email" placeholder="Email" required>
        <input type="password" id="signup-password" placeholder="Password (min 6 characters)" required minlength="6">
        <button type="submit" class="btn-primary">Sign Up</button>
        <button type="button" id="google-signup-btn" class="btn-google">Sign up with Google</button>
        <p>Already have an account? <a href="#" id="show-login">Login</a></p>
      </form>
    </div>
  </div>

  <!-- Pending Approval Screen -->
  <div id="pending-screen" class="screen" style="display: none;">
    <div class="pending-container">
      <h1>Account Pending Approval</h1>
      <p>Your account has been created successfully. Please wait for an administrator to approve your account and assign you a role.</p>
      <p>You will be able to access the system once approved.</p>
      <button id="logout-btn" class="btn-secondary">Logout</button>
    </div>
  </div>

  <!-- Main App -->
  <div id="main-app" class="screen" style="display: none;">
    
    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <h1>Young Farmers Stock Management</h1>
        <div class="user-info">
          <span id="user-name"></span> | 
          <span id="user-role"></span> | 
          <span id="user-shop"></span>
          <button id="logout-btn" class="btn-secondary">Logout</button>
        </div>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="app-nav">
      <button id="dashboard-nav-btn" class="nav-btn active">Dashboard</button>
      <button id="stock-nav-btn" class="nav-btn">Stock Management</button>
      <button id="reports-nav-btn" class="nav-btn">Reports</button>
      <button id="stock-value-nav-btn" class="nav-btn">Stock Value</button>
      <button id="admin-nav-btn" class="nav-btn" style="display: none;">Admin Panel</button>
    </nav>

    <!-- Dashboard Section -->
    <section id="dashboard-section" class="app-section">
      <h2>Dashboard</h2>
      <div class="dashboard-grid">
        <div class="dashboard-card">
          <h3>Total Stock Value</h3>
          <p class="dashboard-value" id="total-stock">KSh 0</p>
        </div>
        <div class="dashboard-card">
          <h3>Today's Sales</h3>
          <p class="dashboard-value" id="total-sales">KSh 0</p>
        </div>
        <div class="dashboard-card">
          <h3>Total Debtors</h3>
          <p class="dashboard-value" id="total-debtors">KSh 0</p>
        </div>
        <div class="dashboard-card">
          <h3>Total Creditors</h3>
          <p class="dashboard-value" id="total-creditors">0 bags</p>
        </div>
      </div>
    </section>

    <!-- Stock Management Section -->
    <section id="stock-section" class="app-section" style="display: none;">
      <h2>Stock Management</h2>
      
      <div class="controls">
        <select id="shop-selector">
          <option value="">Select Shop</option>
        </select>
        <input type="date" id="stock-date">
      </div>

      <div class="stock-table-container">
        <h3>Closing Stock</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Opening Stock</th>
              <th>Restocking</th>
              <th>Closing Stock</th>
              <th>Sales</th>
              <th>Cash</th>
            </tr>
          </thead>
          <tbody id="stock-table-body"></tbody>
        </table>
        <div class="total-row">
          <strong>Total Cash:</strong> <span id="total-cash-display">KSh 0</span>
        </div>
        <button id="save-stock-btn" class="btn-primary">Save Stock Data</button>
      </div>

      <!-- Sales Made on Credit -->
      <div class="transaction-section">
        <h3>Sales Made on Credit</h3>
        <div class="form-grid">
          <input type="text" id="credit-client-name" placeholder="Client Name">
          <select id="credit-feed-type">
            <option value="">Select Feed Type</option>
            <option value="Starter Mash">Starter Mash</option>
            <option value="Samakgro 1MM">Samakgro 1MM</option>
            <option value="Samakgro 2MM">Samakgro 2MM</option>
            <option value="Samakgro 3MM">Samakgro 3MM</option>
            <option value="Samakgro 4MMHP">Samakgro 4MMHP</option>
            <option value="Samakgro 4.5MM">Samakgro 4.5MM</option>
            <option value="Broodstock">Broodstock</option>
          </select>
          <input type="number" id="credit-bags" placeholder="Number of Bags" min="0" step="0.1">
          <input type="number" id="credit-paid" placeholder="Amount Paid" min="0">
          <button id="add-credit-sale-btn" class="btn-primary">Save</button>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>Client Name</th>
              <th>Feed Type</th>
              <th>Bags</th>
              <th>Total Amount</th>
              <th>Paid</th>
              <th>Remaining</th>
            </tr>
          </thead>
          <tbody id="credit-sales-list"></tbody>
        </table>
      </div>

      <!-- Prepayments Made -->
      <div class="transaction-section">
        <h3>Prepayments Made</h3>
        <div class="form-grid">
          <input type="text" id="prepay-client-name" placeholder="Client Name">
          <select id="prepay-feed-type">
            <option value="">Select Feed Type</option>
            <option value="Starter Mash">Starter Mash</option>
            <option value="Samakgro 1MM">Samakgro 1MM</option>
            <option value="Samakgro 2MM">Samakgro 2MM</option>
            <option value="Samakgro 3MM">Samakgro 3MM</option>
            <option value="Samakgro 4MMHP">Samakgro 4MMHP</option>
            <option value="Samakgro 4.5MM">Samakgro 4.5MM</option>
            <option value="Broodstock">Broodstock</option>
          </select>
          <input type="number" id="prepay-amount" placeholder="Amount Paid" min="0">
          <button id="add-prepayment-btn" class="btn-primary">Save</button>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>Client Name</th>
              <th>Feed Type</th>
              <th>Total Bags</th>
              <th>Amount Paid</th>
              <th>Remaining Bags</th>
            </tr>
          </thead>
          <tbody id="prepayments-list"></tbody>
        </table>
      </div>

      <!-- Payments Made Towards Debts -->
      <div class="transaction-section">
        <h3>Payments Made Towards Debts</h3>
        <div class="form-grid">
          <input type="text" id="debt-client-name" placeholder="Client Name">
          <input type="number" id="debt-amount" placeholder="Amount Paid" min="0">
          <select id="debt-method">
            <option value="">Payment Method</option>
            <option value="Cash">Cash</option>
            <option value="M-Pesa">M-Pesa</option>
            <option value="Bank">Bank</option>
          </select>
          <button id="add-debt-payment-btn" class="btn-primary">Save</button>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>Client Name</th>
              <th>Amount Paid</th>
              <th>Payment Method</th>
            </tr>
          </thead>
          <tbody id="debt-payments-list"></tbody>
        </table>
      </div>

      <!-- Feeds Released to Creditors -->
      <div class="transaction-section">
        <h3>Feeds Released to Creditors</h3>
        <div class="form-grid">
          <input type="text" id="release-client-name" placeholder="Client Name">
          <select id="release-feed-type">
            <option value="">Select Feed Type</option>
            <option value="Starter Mash">Starter Mash</option>
            <option value="Samakgro 1MM">Samakgro 1MM</option>
            <option value="Samakgro 2MM">Samakgro 2MM</option>
            <option value="Samakgro 3MM">Samakgro 3MM</option>
            <option value="Samakgro 4MMHP">Samakgro 4MMHP</option>
            <option value="Samakgro 4.5MM">Samakgro 4.5MM</option>
            <option value="Broodstock">Broodstock</option>
          </select>
          <input type="number" id="release-bags" placeholder="Number of Bags" min="0" step="0.1">
          <button id="add-feed-release-btn" class="btn-primary">Save</button>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>Client Name</th>
              <th>Feed Type</th>
              <th>Bags Released</th>
            </tr>
          </thead>
          <tbody id="feed-releases-list"></tbody>
        </table>
      </div>

      <!-- Transfers to Other Shops -->
      <div class="transaction-section">
        <h3>Transfers to Other Shops</h3>
        <div class="form-grid">
          <select id="transfer-to-shop">
            <option value="">Select Destination Shop</option>
            <option value="Usigu">Usigu</option>
            <option value="Port Victoria">Port Victoria</option>
            <option value="Mbita">Mbita</option>
            <option value="Usenge">Usenge</option>
            <option value="Lwanda Kotieno">Lwanda Kotieno</option>
            <option value="Obambo">Obambo</option>
            <option value="Sori">Sori</option>
          </select>
          <select id="transfer-feed-type">
            <option value="">Select Feed Type</option>
            <option value="Starter Mash">Starter Mash</option>
            <option value="Samakgro 1MM">Samakgro 1MM</option>
            <option value="Samakgro 2MM">Samakgro 2MM</option>
            <option value="Samakgro 3MM">Samakgro 3MM</option>
            <option value="Samakgro 4MMHP">Samakgro 4MMHP</option>
            <option value="Samakgro 4.5MM">Samakgro 4.5MM</option>
            <option value="Broodstock">Broodstock</option>
          </select>
          <input type="number" id="transfer-bags" placeholder="Number of Bags" min="0" step="0.1">
          <button id="add-transfer-btn" class="btn-primary">Save</button>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>To Shop</th>
              <th>Feed Type</th>
              <th>Bags Transferred</th>
            </tr>
          </thead>
          <tbody id="transfers-list"></tbody>
        </table>
      </div>

      <!-- Client Details for Regular Sales -->
      <div class="transaction-section">
        <h3>Client Details for Regular Sales</h3>
        <div class="form-grid">
          <input type="text" id="client-name" placeholder="Client Name">
          <select id="client-feed-type">
            <option value="">Select Feed Type</option>
            <option value="Starter Mash">Starter Mash</option>
            <option value="Samakgro 1MM">Samakgro 1MM</option>
            <option value="Samakgro 2MM">Samakgro 2MM</option>
            <option value="Samakgro 3MM">Samakgro 3MM</option>
            <option value="Samakgro 4MMHP">Samakgro 4MMHP</option>
            <option value="Samakgro 4.5MM">Samakgro 4.5MM</option>
            <option value="Broodstock">Broodstock</option>
          </select>
          <input type="number" id="client-bags" placeholder="Number of Bags" min="0" step="0.1">
          <button id="add-client-btn" class="btn-primary">Save</button>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>Client Name</th>
              <th>Feed Type</th>
              <th>Bags</th>
              <th>Total Amount</th>
            </tr>
          </thead>
          <tbody id="clients-list"></tbody>
        </table>
      </div>
    </section>

    <!-- Reports Section -->
    <section id="reports-section" class="app-section" style="display: none;">
      <h2>Reports</h2>
      <div class="export-buttons">
        <button id="export-doc1-btn" class="btn-primary">Export Doc1 Format (Shop Report)</button>
        <button id="export-doc2-btn" class="btn-primary">Export Doc2 Format (Financial Summary)</button>
      </div>
      <div id="reports-content"></div>
    </section>

    <!-- Stock Value Section -->
    <section id="stock-value-section" class="app-section" style="display: none;">
      <h2>Stock Value Analysis</h2>
      <div id="stock-value-content"></div>
    </section>

    <!-- Admin Section -->
    <section id="admin-section" class="app-section" style="display: none;">
      <h2>Admin Panel - User Management</h2>
      <table class="data-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Assigned Shop</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="users-table-body"></tbody>
      </table>
    </section>

  </div>

  <script type="module" src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js');
    }
  </script>
</body>
</html>